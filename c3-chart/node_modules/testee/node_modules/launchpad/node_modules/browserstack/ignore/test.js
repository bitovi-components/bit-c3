var BrowserStack = require( "../lib/browserstack" );

var client = BrowserStack.createClient({
	username: "scott.gonzalez",
	password: "ZgYqe7cX3seqZn"
});

// client.getApiStatus(function( error, status ) {
//   console.log( error, status );
//   console.log( typeof status.running_sessions );
// });

// client.getWorkers(function( error, workers ) {
//   console.log( error, workers );
// });

// client.getBrowsers(function( error, browsers ) {
// 	console.log( "The following browsers are available for testing" );
// 	console.log( browsers.filter(function( browser ) {
// 		return browser.browser === "firefox";
// 	}) );
// });

function create( callback ) {
	client.createWorker({
		os: "Windows",
		os_version: "XP",
		browser: "firefox",
		browser_version: "33.0",
		url: "http://google.com"
	}, function( error, worker ) {
		if ( error ) {
			return callack( error );
		}

		console.log( "created worker", worker );

		wait( worker.id, function( error ) {
			if ( error ) {
				return callback( error );
			}

			callback( null, worker.id );
		});
	});
}

function wait( id, callback ) {
	client.getWorker( id, function( error, worker ) {
		if ( error ) {
			return callback( error );
		}

		console.log( "got worker", worker );

		if ( worker.status === "running" ) {
			return callback( null );
		}

		setTimeout(function() {
			wait( id, callback );
		}, 1000 );
	});
}

create(function( error, id ) {
	if ( error ) {
		console.log( error );
		return;
	}

	client.changeUrl( id, {
		url: "http://microsoft.com"
	}, function() {
		console.log( arguments );

		client.terminateWorker( id, function() {
			console.log( "terminated worker" );
			console.log( arguments );
		});
	});
});

// client.terminateWorker( 5781387, function() {
// 	console.log( arguments );
// });
// client.takeScreenshot( 5781387, function() {
// 	console.log( arguments );
// });


